(window.webpackJsonp=window.webpackJsonp||[]).push([[4,7,16,27,28],[,,,,function(e,t,a){"use strict";a.r(t);var n=a(46),r=a.n(n),o=a(0),c=a.n(o),i=a(1),s=a(36),d=a.n(s),u=a(45),l=a(22),f=a(15);const h=async e=>{const t=`record_${Date.now()}_${r()()}.png`,a=await Object(u.e)(e),n=`record/${t}`;return a&&await f.a.save({type:"image/png",data:a,path:"record/",name:t}),n};t.default=({pCanvasController:e})=>{const[{cursor:t,recorderList:a},n]=Object(o.useReducer)(l.recordListReducer,{cursor:-1,recorderList:[]}),r=t>=0,s=t<a.length-1;Object(o.useEffect)(()=>{const t=async e=>{const{data:{layerDetail:{canvas:t},index:a},tag:r}=e;if("history"===r)return;const o=await h(t);n({type:"add",payload:new l.RecordInfo("add",{index:a,canvasPath:o})})},a=async e=>{const{data:{layerDetail:{canvas:t},preContent:a,index:r},tag:o}=e;"history"!==o&&n({type:"add",payload:new l.RecordInfo("modify",{index:r,fromCanvasPath:await h(a),toCanvasPath:await h(t)})})},r=async e=>{const{data:{layerDetail:{canvas:t},index:a},tag:r}=e;if("history"===r)return;const o=await h(t);n({type:"add",payload:new l.RecordInfo("remove",{index:a,canvasPath:o})})};return e.on("addLayer",t),e.on("contentChange",a),e.on("removeLayer",r),()=>{e.off("addLayer",t),e.off("contentChange",a),e.off("removeLayer",r),f.a.remove("record")}},[]);return c.a.createElement(o.Fragment,null,c.a.createElement("span",{className:`${d.a.recordBtn} ${s&&d.a.recordBtnActive||""} `,onPointerUp:s&&(()=>{n({type:"redo",pCanvasController:e})})||void 0},"redo"),c.a.createElement(i.Divider,null),c.a.createElement("span",{className:`${d.a.recordBtn} ${r&&d.a.recordBtnActive||""}`,onPointerUp:r&&(()=>{n({type:"undo",pCanvasController:e})})||void 0},"undo"))}},,,,,function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return d}));var n=a(0),r=a.n(n),o=a(1),c=a(39),i=a.n(c),s=a(4);function d({pCanvasController:e}){Object(n.useEffect)(()=>{if(e){const t=()=>{e.setBrushWidth(1),e.setOpacity(1)};return e.on("init",t),()=>e.off("init",t)}},[]);return r.a.createElement("div",{className:i.a.asideTool},r.a.createElement(o.Divider,null),r.a.createElement(o.Slider,{defaultValue:1,vertical:!0,min:1,max:200,step:1,onChange:t=>{e&&e.setBrushWidth(t)}}),r.a.createElement(o.Divider,null),r.a.createElement(o.Slider,{vertical:!0,defaultValue:1,min:0,max:1,step:.01,onChange:t=>{e&&e.setOpacity(t)}}),r.a.createElement(o.Divider,null),r.a.createElement(s.default,{pCanvasController:e}),r.a.createElement(o.Divider,null))}},,,,,,,,,,,,,function(e,t,a){"use strict";a.r(t),a.d(t,"RecordData",(function(){return o})),a.d(t,"RecordInfo",(function(){return i})),a.d(t,"recordListReducer",(function(){return d}));var n=a(15),r=a(45);class o{constructor(){this.add=void 0,this.remove=void 0,this.modify=void 0}}const c=async({type:e,data:t})=>{switch(e){case"add":t=t;const{path:e,name:a}=n.a.analyzePath(t.canvasPath);await n.a.remove(e,a);break;case"modify":const{fromCanvasPath:r,toCanvasPath:o}=t,{path:c,name:i}=n.a.analyzePath(o),{path:s,name:d}=n.a.analyzePath(r);await Promise.all([n.a.remove(c,i),n.a.remove(s,d)]);break;case"remove":const{canvasPath:u}=t,{path:l,name:f}=n.a.analyzePath(u);await n.a.remove(l,f)}};class i{constructor(e,t){this.type=e,this.data=t}}const s=async(e,t)=>{const{type:a,data:o}=e;if("add"!==a)if("modify"!==a)if("remove"!==a);else{const{index:e}=o;t.removeLayerByIndex(e,"history")}else{const{index:e,fromCanvasPath:a,toCanvasPath:c}=o,{path:i,name:s}=n.a.analyzePath(c),[{data:d}]=await n.a.get(i,s),u=await Object(r.c)(d),l=t.setLayerContent(e,u,"history");t.focusLayer(l)}else{const{index:e,canvasPath:a}=o,{path:c,name:i}=n.a.analyzePath(a),[{data:s}]=await n.a.get(c,i),d=await Object(r.c)(s),u=t.addLayerContent(e,d,"history");t.focusLayer(u)}},d=({cursor:e,recorderList:t},{type:a,payload:n,pCanvasController:r})=>{switch(a){case"add":if(e<t.length-1){t.splice(Math.max(e,0)).map(e=>c(e))}if(100<=t.length){t.splice(0,t.length-100+1).map(e=>c(e))}e++,n&&t.push(n);break;case"redo":if(++e<=t.length-1){const a=t[e];r&&s(a,r)}break;case"undo":if(e>-1){const a=t[e];r&&s((({type:e,data:t})=>{if("add"===e){const{index:e,canvasPath:a}=t;return new i("remove",{index:e,canvasPath:a})}if("modify"===e){const{index:e,fromCanvasPath:a,toCanvasPath:n}=t;return new i("modify",{index:e,fromCanvasPath:n,toCanvasPath:a})}const{index:a,canvasPath:n}=t;return new i("add",{index:a,canvasPath:n})})(a),r)}e--}return{cursor:Math.max(Math.min(e,t.length-1),-1),recorderList:t}}},,,,,,,,,,,,,,function(e,t,a){e.exports={recordBtn:"recordBtn_81954",recordBtnActive:"recordBtnActive_a74d3"}},,,function(e,t,a){e.exports={asideTool:"asideTool_faaa6"}},,,,,,function(e,t,a){"use strict";a.d(t,"b",(function(){return c})),a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return l})),a.d(t,"e",(function(){return f})),a.d(t,"d",(function(){return v}));var n=a(46),r=a.n(n),o=a(56);new(a.n(o).a);const c=(e=0,t=0,a)=>{const n=document.createElement("canvas");n.width=e,n.height=t,n.setAttribute("uuid",r()("canvasId-"));const o=n.getContext("2d");return o&&a&&(o.fillStyle=a.toRGBAString(),o.fillRect(0,0,e,t)),n},i=(e,t)=>{const a=e.getContext("2d");null==a||a.drawImage(t,0,0)},s=e=>{const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const a=t.getContext("2d"),n=e.getContext("2d");return a&&n&&(a.imageSmoothingEnabled=!1,a.webkitImageSmoothingEnabled=!1,a.putImageData(n.getImageData(0,0,e.width,e.height),0,0)),t},d=[];let u=0;const l=async e=>new Promise(t=>{d.push({file:e,cb:t}),(async()=>{if(u<1){let e=d.shift();for(;e;){u++;const{file:t,cb:a}=e,n=new Image,r=URL.createObjectURL(new Blob([t]));n.src=r;const o=document.createElement("canvas");try{await n.decode(),o.width=n.width,o.height=n.height,i(o,n)}catch(e){}URL.revokeObjectURL(r),a(o),u--,e=d.shift()}}})()}),f=e=>new Promise(t=>{e.toBlob(e=>(async(e,t)=>{if(e){const a=URL.createObjectURL(e);t(await(await fetch(a)).arrayBuffer())}else t(null)})(e,t),"image/png",1)});let h=()=>{const e=c(0,0).toDataURL();return h=()=>e,h()};const v=()=>h()},function(e,t,a){var n=a(52),r=0;e.exports=function(e){var t=++r;return n(e)+t}},function(e,t,a){var n=a(49),r="object"==typeof self&&self&&self.Object===Object&&self,o=n||r||Function("return this")();e.exports=o},function(e,t){e.exports=function(){return!1}},function(e,t,a){(function(t){var a="object"==typeof t&&t&&t.Object===Object&&t;e.exports=a}).call(this,a(50))},function(e,t){var a;a=function(){return this}();try{a=a||new Function("return this")()}catch(e){"object"==typeof window&&(a=window)}e.exports=a},function(e,t){var a=Array.isArray;e.exports=a},function(e,t,a){var n=a(53);e.exports=function(e){return null==e?"":n(e)}},function(e,t,a){var n=a(54),r=a(55),o=a(51),c=a(48),i=n?n.prototype:void 0,s=i?i.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return r(t,e)+"";if(c(t))return s?s.call(t):"";var a=t+"";return"0"==a&&1/t==-1/0?"-0":a}},function(e,t,a){var n=a(47).Symbol;e.exports=n},function(e,t){e.exports=function(e,t){for(var a=-1,n=null==e?0:e.length,r=Array(n);++a<n;)r[a]=t(e[a],a,e);return r}},function(e,t,a){e.exports=function(){return new Worker(a.p+"WorkerName.4812e85ebc24635efccf.js")}}]]);