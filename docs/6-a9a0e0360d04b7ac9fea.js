(window.webpackJsonp=window.webpackJsonp||[]).push([[6,23],[,,,,,,function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return i}));var a=n(0),r=n(57);function i({pCanvasController:t}){return Object(a.useEffect)(()=>{if(t){const e=({data:{workId:t,layerDetail:e}})=>{r.c.saveLayerDetail(t,e)},n=({data:{workId:t,layerDetail:e,index:n}})=>{r.c.saveLayerDetail(t,e,n)};return t.on("contentChange",e),t.on("addLayer",n),()=>{t.off("contentChange",e),t.off("addLayer",n)}}},[t]),null}},,,,,,,,,,,,,,function(t,e,n){"use strict";n.r(e),n.d(e,"RGBA",(function(){return a}));class a{static Lerp(t,e,n){const r=[],i=(e.r-t.r)/n,s=(e.g-t.g)/n,o=(e.b-t.b)/n,c=(e.a-t.a)/n;for(let e=0;e<n;e++)r.push(new a(t.r+i*e,t.g+s*e,t.b+o*e,t.a+c*e));return r}static mutipy({r:t,g:e,b:n},r){return new a(t*r,e*r,n*r)}static add({r:t,g:e,b:n},r){return new a(t+r.r,e+r.g,n+r.b)}static mix(t,e,n){return new a(t.r+(e.r-t.r)*n,t.g+(e.g-t.g)*n,t.b+(e.b-t.b)*n)}static getLerpColor(t,e,n){const{r:r,g:i,b:s,a:o}=t;return new a((e.r-r)*n+r,(e.g-i)*n+i,(e.b-s)*n+s,(e.a-o)*n+o)}constructor(t,e,n,a=1){this.r=t,this.g=e,this.b=n,this.a=a}toRGBAString(){return`rgba(${this.r},${this.g},${this.b},${this.a})`}}a.BLACK=new a(0,0,0),a.WHITE=new a(255,255,255)},,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return s})),n.d(e,"c",(function(){return u})),n.d(e,"e",(function(){return l})),n.d(e,"d",(function(){return h}));var a=n(46),r=n.n(a);const i=(t=0,e=0,n)=>{const a=document.createElement("canvas");a.width=t,a.height=e,a.setAttribute("uuid",r()("canvasId-"));const i=a.getContext("2d");return i&&n&&(i.fillStyle=n.toRGBAString(),i.fillRect(0,0,t,e)),a},s=t=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");return n&&(n.imageSmoothingEnabled=!1,n.clearRect(0,0,e.width,e.height),n.drawImage(t,0,0,t.width,t.height)),e},o=[];let c=0;const u=async t=>new Promise(e=>{o.push({file:t,cb:e}),(async()=>{if(c<1){let t=o.shift();for(;t;){c++;const{file:e,cb:n}=t,a=new Image;a.src=URL.createObjectURL(e);try{await a.decode()}catch(t){}URL.revokeObjectURL(a.src),n(a),c--,t=o.shift()}}})()}),l=t=>new Promise(e=>{t.toBlob(e,"image/png",1)});let f=()=>{const t=i(0,0).toDataURL();return f=()=>t,f()};const h=()=>f()},function(t,e,n){var a=n(52),r=0;t.exports=function(t){var e=++r;return a(t)+e}},function(t,e,n){var a=n(49),r="object"==typeof self&&self&&self.Object===Object&&self,i=a||r||Function("return this")();t.exports=i},function(t,e){t.exports=function(){return!1}},function(t,e,n){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(this,n(50))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){var n=Array.isArray;t.exports=n},function(t,e,n){var a=n(53);t.exports=function(t){return null==t?"":a(t)}},function(t,e,n){var a=n(54),r=n(55),i=n(51),s=n(48),o=a?a.prototype:void 0,c=o?o.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(i(e))return r(e,t)+"";if(s(e))return c?c.call(e):"";var n=e+"";return"0"==n&&1/e==-1/0?"-0":n}},function(t,e,n){var a=n(47).Symbol;t.exports=a},function(t,e){t.exports=function(t,e){for(var n=-1,a=null==t?0:t.length,r=Array(a);++n<a;)r[n]=e(t[n],n,t);return r}},,function(t,e,n){"use strict";n.d(e,"c",(function(){return b})),n.d(e,"b",(function(){return l})),n.d(e,"a",(function(){return f}));var a=n(58),r=n.n(a),i=n(46),s=n.n(i),o=n(20),c=n(45);class u{constructor(t,e,n="",a,r=Date.now(),i=Date.now(),o=s()(`work_${Date.now()}_`)){this.width=t,this.height=e,this.name=n,this.thumbnail=a,this.createTime=r,this.updateTime=i,this.workId=o}}class l{constructor(t,e=[]){this.workInfo=t,this.layers=e}static createEmpty(t,e,n){const a=new u(t,e,"new work",Object(c.d)()),r=[];return r.push(f.create(a,o.RGBA.WHITE)),new l(a,r)}}class f{constructor(t,e="new layer",n=!0,a=s()(`layer-${Date.now()}-`)){this.canvas=t,this.name=e,this.visible=n,this.layerId=a}static create({width:t,height:e},n){const a=Object(c.b)(t,e,n),r=new f(a);return a.setAttribute("layerId",r.layerId),r}}var h=n(15);const d=(t,e)=>e?`layers/${t}/${e}.png`:`layers/${t}`,w=t=>`thumbnail/${t}.png`;class p{constructor(t){this.workInfo=void 0,this.layers=void 0;const{workInfo:e,layers:n}=t,{thumbnail:a,workId:r,...i}=e;this.workInfo={workId:r,...i,thumbnail:w(r)},this.layers=n.map(({canvas:t,layerId:e,...n})=>({layerId:e,...n,canvas:d(r,e)}))}}class b{static async saveWork(t){if(!t)return;const e=new p(t);await this.saveWorkInfo(e);const n=this.getCanvasFileList(t,e);for(let t=0;t<n.length;t++){const{path:e,canvas:a}=n[t],r=await Object(c.e)(a);r&&await h.a.save({type:"image/png",path:e,data:r})}}static async saveWorkInfo(t){await h.a.save({type:"application/json",path:`${t.workInfo.workId}.json`,data:JSON.stringify(t)})}static getCanvasFileList(t,e){const{layers:n}=t,{layers:a}=e,r=[{path:e.workInfo.thumbnail,canvas:this.combimeCanvas(100,100,n.map(({canvas:t})=>t))}];return n.forEach(({canvas:t},e)=>{r.push({canvas:t,path:a[e].canvas})}),r}static combimeCanvas(t,e,n){const a=Object(c.b)(t,e),r=a.getContext("2d");if(r)for(let a=n.length-1;a>-1;a--){const i=n[a];r.drawImage(i,0,0,i.width,i.height,0,0,t,e)}return a}static async saveLayerDetail(t,e,n){const{canvas:a,layerId:i,...s}=e,o=await Object(c.e)(a);if(!o)return;h.a.save({type:"image/png",path:d(t,i),data:o});const[u]=await h.a.get(`${t}.json`,{isDir:!1}),l=JSON.parse(await u.text()),f=l.layers.find(({layerId:t})=>t===i);if(!f&&r()(n)&&(l.layers.splice(n,0,{canvas:d(t,i),layerId:i,...s}),await this.saveWorkInfo(l)),f&&r()(n))throw"add layer fail: "+i}static async removeWork(t){}static async updateLayerDetail(t,e){}static async getWorkDetail(t){const[e]=await h.a.get(`${t}.json`,{isDir:!1}),n=await e.text(),{workInfo:a,layers:r}=JSON.parse(n),i=[],s=(await h.a.get(d(t),{isDir:!0})).reduce((t,e)=>({...t,[e.name]:e}),{}),o=[];for(let t=0;t<r.length;t++){const{layerId:e,visible:n,name:a}=r[t],i=s[`${e}.png`];if(i)try{const t=await Object(c.c)(i),r=Object(c.a)(t);o.push({canvas:r,name:a,visible:n,layerId:e})}catch(t){}}return o.forEach(({canvas:t,name:e,visible:n,layerId:a},r)=>{const s=new f(t,e,n,a);i.push(s)}),new l(a,i)}static async getWorkList(){let t;const[e,n]=await Promise.all([h.a.get("",{isDir:!0}),h.a.get("thumbnail",{isDir:!0})]);return t=(await Promise.all(e.map(t=>t.text()))).map(t=>{const{workInfo:{thumbnail:e,workId:a,...r}}=JSON.parse(t);return{...r,workId:a,thumbnail:URL.createObjectURL(n.find(({name:t})=>t===`${a}.png`))}}),t}}},function(t,e,n){var a=n(59),r=n(60);t.exports=function(t){return"number"==typeof t||r(t)&&"[object Number]"==a(t)}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}}]]);