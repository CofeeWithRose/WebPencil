(window.webpackJsonp=window.webpackJsonp||[]).push([[10,12,20,23,25,26],{13:function(t,e,a){"use strict";a.r(e);var n=a(0),s=a.n(n),r=a(75),i=a(41),c=a.n(i),o=a(8),l={name:"plus",theme:"outlined",icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M176 474h672q8 0 8 8v60q0 8-8 8H176q-8 0-8-8v-60q0-8 8-8z"}}]}},u=a(83),m=function(t,e){return n.createElement(u.a,Object.assign({},t,{ref:e,icon:l}))};m.displayName="PlusOutlined";var h=n.forwardRef(m),d=a(27),w=a(80),p=a.n(w),f=a(57),g=a(20),b=a(2);e.default=()=>{const[t,e]=Object(n.useState)(!1),[a,i]=Object(n.useState)([]),{push:l}=Object(b.useHistory)();Object(n.useEffect)(()=>{(async()=>{const t=await f.c.getWorkList();i(t)})()},[]);const u=t=>{l({pathname:"/paint",search:p.a.stringify({workId:t})})};return s.a.createElement(r.a,{showBackButton:!1,asideClass:c.a.asideClass},s.a.createElement("main",{className:c.a.listWrap},s.a.createElement(o.default,{id:"add",name:"新建",content:s.a.createElement(h,{style:{fontSize:"30px"}}),onPointerUp:()=>e(!0)}),a.map(({workId:t,name:e,thumbnail:a})=>s.a.createElement(o.default,{key:t,id:t,name:e,content:s.a.createElement("img",{src:a}),onPointerUp:()=>u(t)}))),s.a.createElement(d.FileMenu,{isVisibale:t,onComplete:async({width:t,height:e})=>{const a=f.b.createEmpty(t,e,g.RGBA.WHITE);await f.c.saveWork(a),u(a.workInfo.workId)},onCancel:()=>e(!1)}))}},20:function(t,e,a){"use strict";a.r(e),a.d(e,"RGBA",(function(){return n}));class n{static Lerp(t,e,a){const s=[],r=(e.r-t.r)/a,i=(e.g-t.g)/a,c=(e.b-t.b)/a,o=(e.a-t.a)/a;for(let e=0;e<a;e++)s.push(new n(t.r+r*e,t.g+i*e,t.b+c*e,t.a+o*e));return s}static mutipy({r:t,g:e,b:a},s){return new n(t*s,e*s,a*s)}static add({r:t,g:e,b:a},s){return new n(t+s.r,e+s.g,a+s.b)}static mix(t,e,a){return new n(t.r+(e.r-t.r)*a,t.g+(e.g-t.g)*a,t.b+(e.b-t.b)*a)}static getLerpColor(t,e,a){const{r:s,g:r,b:i,a:c}=t;return new n((e.r-s)*a+s,(e.g-r)*a+r,(e.b-i)*a+i,(e.a-c)*a+c)}constructor(t,e,a,n=1){this.r=t,this.g=e,this.b=a,this.a=n}toRGBAString(){return`rgba(${this.r},${this.g},${this.b},${this.a})`}}n.BLACK=new n(0,0,0),n.WHITE=new n(255,255,255)},27:function(t,e,a){"use strict";a.r(e),a.d(e,"FileMenu",(function(){return i}));var n=a(0),s=a.n(n),r=a(1);const i=({className:t="",isVisibale:e,onComplete:a,onCancel:n})=>{const[i]=r.Form.useForm(),c=t=>`${t||0}px`,o=t=>(t||"").replace("px","");return s.a.createElement("div",null,s.a.createElement(r.Form,{form:i,initialValues:{width:2048,height:2048}},s.a.createElement(r.Modal,{visible:e,onCancel:n,title:"创建",className:t,okButtonProps:{onPointerUp:async()=>{const t=await i.validateFields();a&&a(t)}}},s.a.createElement(r.Form.Item,{name:"width",label:"宽度",rules:[{required:!0,message:"请填写画布宽度"}]},s.a.createElement(r.InputNumber,{min:1,max:4096,precision:0,formatter:c,parser:o})),s.a.createElement(r.Form.Item,{name:"height",label:"高度",rules:[{required:!0,message:"请填写画布高度"}]},s.a.createElement(r.InputNumber,{min:1,max:4096,precision:0,formatter:c,parser:o})))))}},38:function(t,e,a){t.exports={workItem:"workItem_b96c1",imgBox:"imgBox_8e40a"}},41:function(t,e,a){t.exports={listWrap:"listWrap_fdcf4",asideClass:"asideClass_03988"}},45:function(t,e,a){"use strict";a.d(e,"b",(function(){return r})),a.d(e,"a",(function(){return i})),a.d(e,"c",(function(){return l})),a.d(e,"e",(function(){return u})),a.d(e,"d",(function(){return h}));var n=a(46),s=a.n(n);const r=(t=0,e=0,a)=>{const n=document.createElement("canvas");n.width=t,n.height=e,n.setAttribute("uuid",s()("canvasId-"));const r=n.getContext("2d");return r&&a&&(r.fillStyle=a.toRGBAString(),r.fillRect(0,0,t,e)),n},i=t=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const a=e.getContext("2d");return a&&(a.imageSmoothingEnabled=!1,a.clearRect(0,0,e.width,e.height),a.drawImage(t,0,0,t.width,t.height)),e},c=[];let o=0;const l=async t=>new Promise(e=>{c.push({file:t,cb:e}),(async()=>{if(o<1){let t=c.shift();for(;t;){o++;const{file:e,cb:a}=t,n=new Image;n.src=URL.createObjectURL(e);try{await n.decode()}catch(t){}URL.revokeObjectURL(n.src),a(n),o--,t=c.shift()}}})()}),u=t=>new Promise(e=>{t.toBlob(e,"image/png",1)});let m=()=>{const t=r(0,0).toDataURL();return m=()=>t,m()};const h=()=>m()},57:function(t,e,a){"use strict";a.d(e,"c",(function(){return f})),a.d(e,"b",(function(){return u})),a.d(e,"a",(function(){return m}));var n=a(58),s=a.n(n),r=a(46),i=a.n(r),c=a(20),o=a(45);class l{constructor(t,e,a="",n,s=Date.now(),r=Date.now(),c=i()(`work_${Date.now()}_`)){this.width=t,this.height=e,this.name=a,this.thumbnail=n,this.createTime=s,this.updateTime=r,this.workId=c}}class u{constructor(t,e=[]){this.workInfo=t,this.layers=e}static createEmpty(t,e,a){const n=new l(t,e,"new work",Object(o.d)()),s=[];return s.push(m.create(n,c.RGBA.WHITE)),new u(n,s)}}class m{constructor(t,e="new layer",a=!0,n=i()(`layer-${Date.now()}-`)){this.canvas=t,this.name=e,this.visible=a,this.layerId=n}static create({width:t,height:e},a){const n=Object(o.b)(t,e,a),s=new m(n);return n.setAttribute("layerId",s.layerId),s}}var h=a(15);const d=(t,e)=>e?`layers/${t}/${e}.png`:`layers/${t}`,w=t=>`thumbnail/${t}.png`;class p{constructor(t){this.workInfo=void 0,this.layers=void 0;const{workInfo:e,layers:a}=t,{thumbnail:n,workId:s,...r}=e;this.workInfo={workId:s,...r,thumbnail:w(s)},this.layers=a.map(({canvas:t,layerId:e,...a})=>({layerId:e,...a,canvas:d(s,e)}))}}class f{static async saveWork(t){if(!t)return;const e=new p(t);await this.saveWorkInfo(e);const a=this.getCanvasFileList(t,e);for(let t=0;t<a.length;t++){const{path:e,canvas:n}=a[t],s=await Object(o.e)(n);s&&await h.a.save({type:"image/png",path:e,data:s})}}static async saveWorkInfo(t){await h.a.save({type:"application/json",path:`${t.workInfo.workId}.json`,data:JSON.stringify(t)})}static getCanvasFileList(t,e){const{layers:a}=t,{layers:n}=e,s=[{path:e.workInfo.thumbnail,canvas:this.combimeCanvas(100,100,a.map(({canvas:t})=>t))}];return a.forEach(({canvas:t},e)=>{s.push({canvas:t,path:n[e].canvas})}),s}static combimeCanvas(t,e,a){const n=Object(o.b)(t,e),s=n.getContext("2d");if(s)for(let n=a.length-1;n>-1;n--){const r=a[n];s.drawImage(r,0,0,r.width,r.height,0,0,t,e)}return n}static async saveLayerDetail(t,e,a){const{canvas:n,layerId:r,...i}=e,c=await Object(o.e)(n);if(!c)return;h.a.save({type:"image/png",path:d(t,r),data:c});const[l]=await h.a.get(`${t}.json`,{isDir:!1}),u=JSON.parse(await l.text()),m=u.layers.find(({layerId:t})=>t===r);if(!m&&s()(a)&&(u.layers.splice(a,0,{canvas:d(t,r),layerId:r,...i}),await this.saveWorkInfo(u)),m&&s()(a))throw"add layer fail: "+r}static async removeWork(t){}static async updateLayerDetail(t,e){}static async getWorkDetail(t){const[e]=await h.a.get(`${t}.json`,{isDir:!1}),a=await e.text(),{workInfo:n,layers:s}=JSON.parse(a),r=[],i=(await h.a.get(d(t),{isDir:!0})).reduce((t,e)=>({...t,[e.name]:e}),{}),c=[];for(let t=0;t<s.length;t++){const{layerId:e,visible:a,name:n}=s[t],r=i[`${e}.png`];if(r)try{const t=await Object(o.c)(r),s=Object(o.a)(t);c.push({canvas:s,name:n,visible:a,layerId:e})}catch(t){}}return c.forEach(({canvas:t,name:e,visible:a,layerId:n},s)=>{const i=new m(t,e,a,n);r.push(i)}),new u(n,r)}static async getWorkList(){let t;const[e,a]=await Promise.all([h.a.get("",{isDir:!0}),h.a.get("thumbnail",{isDir:!0})]);return t=(await Promise.all(e.map(t=>t.text()))).map(t=>{const{workInfo:{thumbnail:e,workId:n,...s}}=JSON.parse(t);return{...s,workId:n,thumbnail:URL.createObjectURL(a.find(({name:t})=>t===`${n}.png`))}}),t}}},75:function(t,e,a){"use strict";a.d(e,"a",(function(){return u}));var n=a(0),s=a.n(n),r=a(76),i=a.n(r),c=a(1),o=a(91),l=a(2);function u({className:t="",headNode:e=null,asideClass:a="",asideNode:n=null,children:r=null,beforeBack:u,showBackButton:m=!0,contentClassName:h=""}){const{goBack:d}=Object(l.useHistory)();return s.a.createElement("section",{className:`${i.a.section} ${t}`},s.a.createElement("header",null,m&&s.a.createElement(c.Button,{ghost:!0,onPointerUp:async()=>{(u&&await u()||!u)&&d()},shape:"circle",size:"small",icon:s.a.createElement(o.a,null)}),!1,e),s.a.createElement("div",{className:i.a.wrapper},s.a.createElement("aside",{className:a},n),s.a.createElement("main",{className:h},r)))}},76:function(t,e,a){t.exports={section:"section_c21f7",wrapper:"wrapper_e44d8"}},8:function(t,e,a){"use strict";a.r(e);var n=a(0),s=a.n(n),r=a(38),i=a.n(r);e.default=({name:t,content:e,id:a,onPointerUp:n})=>s.a.createElement("section",{className:i.a.workItem,onPointerUp:()=>n&&n(a)},s.a.createElement("div",{className:i.a.imgBox},e),s.a.createElement("p",null,t))}}]);