(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{22:function(t,e,a){"use strict";a.r(e),a.d(e,"RecordData",(function(){return o})),a.d(e,"RecordInfo",(function(){return i})),a.d(e,"recordListReducer",(function(){return u}));var n=a(15),r=a(45);class o{constructor(){this.add=void 0,this.remove=void 0,this.modify=void 0}}const c=async({type:t,data:e})=>{switch(t){case"add":e=e;const{path:t,name:a}=n.a.analyzePath(e.canvasPath);await n.a.remove(t,a);break;case"modify":const{fromCanvasPath:r,toCanvasPath:o}=e,{path:c,name:i}=n.a.analyzePath(o),{path:s,name:u}=n.a.analyzePath(r);await Promise.all([n.a.remove(c,i),n.a.remove(s,u)]);break;case"remove":const{canvasPath:d}=e,{path:h,name:f}=n.a.analyzePath(d);await n.a.remove(h,f)}};class i{constructor(t,e){this.type=t,this.data=e}}const s=async(t,e)=>{const{type:a,data:o}=t;if("add"!==a)if("modify"!==a)if("remove"!==a);else{const{index:t}=o;e.removeLayerByIndex(t,"history")}else{const{index:t,fromCanvasPath:a,toCanvasPath:c}=o,{path:i,name:s}=n.a.analyzePath(c),[{data:u}]=await n.a.get(i,s),d=await Object(r.c)(u),h=e.setLayerContent(t,d,"history");e.focusLayer(h)}else{const{index:t,canvasPath:a}=o,{path:c,name:i}=n.a.analyzePath(a),[{data:s}]=await n.a.get(c,i),u=await Object(r.c)(s),d=e.addLayerContent(t,u,"history");e.focusLayer(d)}},u=({cursor:t,recorderList:e},{type:a,payload:n,pCanvasController:r})=>{switch(a){case"add":if(t<e.length-1){e.splice(Math.max(t,0)).map(t=>c(t))}if(100<=e.length){e.splice(0,e.length-100+1).map(t=>c(t))}t++,n&&e.push(n);break;case"redo":if(++t<=e.length-1){const a=e[t];r&&s(a,r)}break;case"undo":if(t>-1){const a=e[t];r&&s((({type:t,data:e})=>{if("add"===t){const{index:t,canvasPath:a}=e;return new i("remove",{index:t,canvasPath:a})}if("modify"===t){const{index:t,fromCanvasPath:a,toCanvasPath:n}=e;return new i("modify",{index:t,fromCanvasPath:n,toCanvasPath:a})}const{index:a,canvasPath:n}=e;return new i("add",{index:a,canvasPath:n})})(a),r)}t--}return{cursor:Math.max(Math.min(t,e.length-1),-1),recorderList:e}}},45:function(t,e,a){"use strict";a.d(e,"b",(function(){return c})),a.d(e,"a",(function(){return s})),a.d(e,"c",(function(){return h})),a.d(e,"e",(function(){return f})),a.d(e,"d",(function(){return v}));var n=a(46),r=a.n(n),o=a(56);new(a.n(o).a);const c=(t=0,e=0,a)=>{const n=document.createElement("canvas");n.width=t,n.height=e,n.setAttribute("uuid",r()("canvasId-"));const o=n.getContext("2d");return o&&a&&(o.fillStyle=a.toRGBAString(),o.fillRect(0,0,t,e)),n},i=(t,e)=>{const a=t.getContext("2d");null==a||a.drawImage(e,0,0)},s=t=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const a=e.getContext("2d"),n=t.getContext("2d");return a&&n&&(a.imageSmoothingEnabled=!1,a.putImageData(n.getImageData(0,0,t.width,t.height),0,0)),e},u=[];let d=0;const h=async t=>new Promise(e=>{u.push({file:t,cb:e}),(async()=>{if(d<1){let t=u.shift();for(;t;){d++;const{file:e,cb:a}=t,n=new Image,r=URL.createObjectURL(new Blob([e]));n.src=r;const o=document.createElement("canvas");try{await n.decode(),o.width=n.width,o.height=n.height,i(o,n)}catch(t){}URL.revokeObjectURL(r),a(o),d--,t=u.shift()}}})()}),f=t=>new Promise(e=>{t.toBlob(t=>(async(t,e)=>{if(t){const a=URL.createObjectURL(t);e(await(await fetch(a)).arrayBuffer())}else e(null)})(t,e),"image/png",1)});let l=()=>{const t=c(0,0).toDataURL();return l=()=>t,l()};const v=()=>l()},46:function(t,e,a){var n=a(52),r=0;t.exports=function(t){var e=++r;return n(t)+e}},47:function(t,e,a){var n=a(49),r="object"==typeof self&&self&&self.Object===Object&&self,o=n||r||Function("return this")();t.exports=o},48:function(t,e){t.exports=function(){return!1}},49:function(t,e,a){(function(e){var a="object"==typeof e&&e&&e.Object===Object&&e;t.exports=a}).call(this,a(50))},50:function(t,e){var a;a=function(){return this}();try{a=a||new Function("return this")()}catch(t){"object"==typeof window&&(a=window)}t.exports=a},51:function(t,e){var a=Array.isArray;t.exports=a},52:function(t,e,a){var n=a(53);t.exports=function(t){return null==t?"":n(t)}},53:function(t,e,a){var n=a(54),r=a(55),o=a(51),c=a(48),i=n?n.prototype:void 0,s=i?i.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(o(e))return r(e,t)+"";if(c(e))return s?s.call(e):"";var a=e+"";return"0"==a&&1/e==-1/0?"-0":a}},54:function(t,e,a){var n=a(47).Symbol;t.exports=n},55:function(t,e){t.exports=function(t,e){for(var a=-1,n=null==t?0:t.length,r=Array(n);++a<n;)r[a]=e(t[a],a,t);return r}},56:function(t,e,a){t.exports=function(){return new Worker(a.p+"WorkerName.b03f5c6277ae088ef23e.js")}}}]);