(window.webpackJsonp=window.webpackJsonp||[]).push([[9,12,20,23,25,26],{13:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return y}));var n=a(0),r=a.n(n),s=a(76),i=a(41),c=a.n(i),o=a(8),l={name:"plus",theme:"outlined",icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M176 474h672q8 0 8 8v60q0 8-8 8H176q-8 0-8-8v-60q0-8 8-8z"}}]}},u=a(84),m=function(t,e){return n.createElement(u.a,Object.assign({},t,{ref:e,icon:l}))};m.displayName="PlusOutlined";var d=n.forwardRef(m),h=a(27),w=a(81),f=a.n(w),p=a(58),g=a(20),b=a(2);function y(){const[t,e]=Object(n.useState)(!1),[a,i]=Object(n.useState)([]),{push:l}=Object(b.useHistory)();Object(n.useEffect)(()=>((async()=>{const t=await p.c.getWorkList();i(t)})(),()=>{i([])}),[]);const u=t=>{l({pathname:"/paint",search:f.a.stringify({workId:t})})};return r.a.createElement(s.a,{showBackButton:!1,asideClass:c.a.asideClass},r.a.createElement("main",{className:c.a.listWrap},r.a.createElement(o.default,{id:"add",name:"新建",content:r.a.createElement(d,{style:{fontSize:"30px"}}),onPointerUp:()=>e(!0)}),a.map(({workId:t,name:e,thumbnail:a})=>(URL.revokeObjectURL(a),r.a.createElement(o.default,{key:t,id:t,name:e,content:r.a.createElement("img",{src:a,onLoad:()=>URL.revokeObjectURL(a)}),onPointerUp:()=>u(t)})))),r.a.createElement(h.FileMenu,{isVisibale:t,onComplete:async({width:t,height:e})=>{const a=p.b.createEmpty(t,e,g.RGBA.WHITE);await p.c.saveWork(a),u(a.workInfo.workId)},onCancel:()=>e(!1)}))}},20:function(t,e,a){"use strict";a.r(e),a.d(e,"RGBA",(function(){return n}));class n{static Lerp(t,e,a){const r=[],s=(e.r-t.r)/a,i=(e.g-t.g)/a,c=(e.b-t.b)/a,o=(e.a-t.a)/a;for(let e=0;e<a;e++)r.push(new n(t.r+s*e,t.g+i*e,t.b+c*e,t.a+o*e));return r}static mutipy({r:t,g:e,b:a},r){return new n(t*r,e*r,a*r)}static add({r:t,g:e,b:a},r){return new n(t+r.r,e+r.g,a+r.b)}static mix(t,e,a){return new n(t.r+(e.r-t.r)*a,t.g+(e.g-t.g)*a,t.b+(e.b-t.b)*a)}static getLerpColor(t,e,a){const{r:r,g:s,b:i,a:c}=t;return new n((e.r-r)*a+r,(e.g-s)*a+s,(e.b-i)*a+i,(e.a-c)*a+c)}constructor(t,e,a,n=1){this.r=t,this.g=e,this.b=a,this.a=n}toRGBAString(){return`rgba(${this.r},${this.g},${this.b},${this.a})`}}n.BLACK=new n(0,0,0),n.WHITE=new n(255,255,255)},27:function(t,e,a){"use strict";a.r(e),a.d(e,"FileMenu",(function(){return i}));var n=a(0),r=a.n(n),s=a(1);const i=({className:t="",isVisibale:e,onComplete:a,onCancel:n})=>{const[i]=s.Form.useForm(),c=t=>`${t||0}px`,o=t=>(t||"").replace("px","");return r.a.createElement("div",null,r.a.createElement(s.Form,{form:i,initialValues:{width:2048,height:2048}},r.a.createElement(s.Modal,{visible:e,onCancel:n,title:"创建",className:t,okButtonProps:{onPointerUp:async()=>{const t=await i.validateFields();a&&a(t)}}},r.a.createElement(s.Form.Item,{name:"width",label:"宽度",rules:[{required:!0,message:"请填写画布宽度"}]},r.a.createElement(s.InputNumber,{min:1,max:4096,precision:0,formatter:c,parser:o})),r.a.createElement(s.Form.Item,{name:"height",label:"高度",rules:[{required:!0,message:"请填写画布高度"}]},r.a.createElement(s.InputNumber,{min:1,max:4096,precision:0,formatter:c,parser:o})))))}},38:function(t,e,a){t.exports={workItem:"workItem_b96c1",imgBox:"imgBox_8e40a"}},41:function(t,e,a){t.exports={listWrap:"listWrap_fdcf4",asideClass:"asideClass_03988"}},45:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"a",(function(){return o})),a.d(e,"c",(function(){return m})),a.d(e,"e",(function(){return d})),a.d(e,"d",(function(){return w}));var n=a(46),r=a.n(n),s=a(56);new(a.n(s).a);const i=(t=0,e=0,a)=>{const n=document.createElement("canvas");n.width=t,n.height=e,n.setAttribute("uuid",r()("canvasId-"));const s=n.getContext("2d");return s&&a&&(s.fillStyle=a.toRGBAString(),s.fillRect(0,0,t,e)),n},c=(t,e)=>{const a=t.getContext("2d");null==a||a.drawImage(e,0,0)},o=t=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const a=e.getContext("2d"),n=t.getContext("2d");return a&&n&&(a.imageSmoothingEnabled=!1,a.putImageData(n.getImageData(0,0,t.width,t.height),0,0)),e},l=[];let u=0;const m=async t=>new Promise(e=>{l.push({file:t,cb:e}),(async()=>{if(u<1){let t=l.shift();for(;t;){u++;const{file:e,cb:a}=t,n=new Image,r=URL.createObjectURL(new Blob([e]));n.src=r;const s=document.createElement("canvas");try{await n.decode(),s.width=n.width,s.height=n.height,c(s,n)}catch(t){}URL.revokeObjectURL(r),a(s),u--,t=l.shift()}}})()}),d=t=>new Promise(e=>{t.toBlob(t=>(async(t,e)=>{if(t){const a=URL.createObjectURL(t);e(await(await fetch(a)).arrayBuffer())}else e(null)})(t,e),"image/png",1)});let h=()=>{const t=i(0,0).toDataURL();return h=()=>t,h()};const w=()=>h()},56:function(t,e,a){t.exports=function(){return new Worker(a.p+"WorkerName.4812e85ebc24635efccf.js")}},58:function(t,e,a){"use strict";a.d(e,"c",(function(){return p})),a.d(e,"b",(function(){return u})),a.d(e,"a",(function(){return m}));var n=a(59),r=a.n(n),s=a(46),i=a.n(s),c=a(20),o=a(45);class l{constructor(t,e,a="",n,r=Date.now(),s=Date.now(),c=i()(`work_${Date.now()}_`)){this.width=t,this.height=e,this.name=a,this.thumbnail=n,this.createTime=r,this.updateTime=s,this.workId=c}}class u{constructor(t,e=[]){this.workInfo=t,this.layers=e}static createEmpty(t,e,a){const n=new l(t,e,"new work",Object(o.d)()),r=[];return r.push(m.create(n,c.RGBA.WHITE)),new u(n,r)}}class m{constructor(t,e="new layer",a=!0,n=i()(`layer-${Date.now()}-`)){this.canvas=t,this.name=e,this.visible=a,this.layerId=n}static create({width:t,height:e},a){const n=Object(o.b)(t,e,a),r=new m(n);return n.setAttribute("layerId",r.layerId),r}}var d=a(15);const h=(t,e)=>e?`layers/${t}/${e}.png`:`layers/${t}`,w=t=>`thumbnail/${t}.png`;class f{constructor(t){this.workInfo=void 0,this.layers=void 0;const{workInfo:e,layers:a}=t,{thumbnail:n,workId:r,...s}=e;this.workInfo={workId:r,...s,thumbnail:w(r)},this.layers=a.map(({canvas:t,layerId:e,...a})=>({layerId:e,...a,canvas:h(r,e)}))}}class p{static async saveWork(t){if(!t)return;const e=new f(t);await this.saveWorkInfo(e);const a=this.getCanvasFileList(t,e);for(let t=0;t<a.length;t++){const{path:e,canvas:n}=a[t],{path:r,name:s}=d.a.analyzePath(e),i=await Object(o.e)(n);i&&await d.a.save({type:"image/png",path:r,data:i,name:s})}}static async saveWorkInfo(t){await d.a.save({type:"application/json",path:"",name:`${t.workInfo.workId}.json`,data:JSON.stringify(t)})}static getCanvasFileList(t,e){const{layers:a}=t,{layers:n}=e,r=[{path:e.workInfo.thumbnail,canvas:this.combimeCanvas(100,100,a.map(({canvas:t})=>t))}];return a.forEach(({canvas:t},e)=>{r.push({canvas:t,path:n[e].canvas})}),r}static combimeCanvas(t,e,a){const n=Object(o.b)(t,e),r=n.getContext("2d");if(r)for(let t=a.length-1;t>-1;t--){const e=a[t];r.drawImage(e,0,0,e.width,e.height)}return n}static async saveLayerDetail(t,e,a){const{canvas:n,layerId:s,...i}=e,c=await Object(o.e)(n);if(!c)return;const{path:l,name:u}=d.a.analyzePath(h(t,s));d.a.save({type:"image/png",path:l,name:u,data:c});const[{data:m}]=await d.a.get("",`${t}.json`),w=JSON.parse(m),f=w.layers.find(({layerId:t})=>t===s);if(!f&&r()(a)&&(w.layers.splice(a,0,{canvas:h(t,s),layerId:s,...i}),await this.saveWorkInfo(w)),f&&r()(a))throw"add layer fail: "+s}static async removeWork(t){}static async updateLayerDetail(t,e){}static async getWorkDetail(t){const[{data:e}]=await d.a.get("",`${t}.json`),{workInfo:a,layers:n}=JSON.parse(e),r=[],s=(await d.a.get(h(t))).reduce((t,{data:e,name:a})=>({...t,[a]:e}),{}),i=[];for(let t=0;t<n.length;t++){const{layerId:e,visible:a,name:r}=n[t],c=s[`${e}.png`];if(c)try{const t=await Object(o.c)(c);i.push({canvas:t,name:r,visible:a,layerId:e})}catch(t){}}return i.forEach(({canvas:t,name:e,visible:a,layerId:n},s)=>{const i=new m(t,e,a,n);r.push(i)}),new u(a,r)}static async getWorkList(){let t;const[e,a]=await Promise.all([d.a.get(""),d.a.get("thumbnail")]);return t=e.map(({data:t})=>t).map(t=>{const{workInfo:{thumbnail:e,workId:n,...r}}=JSON.parse(t),s=a.find(({name:t})=>t===`${n}.png`);if(s)return{...r,workId:n,thumbnail:URL.createObjectURL(new Blob([s.data]))};throw"workInfoList error "+n}),t}}},76:function(t,e,a){"use strict";a.d(e,"a",(function(){return u}));var n=a(0),r=a.n(n),s=a(77),i=a.n(s),c=a(1),o=a(92),l=a(2);function u({className:t="",headNode:e=null,asideClass:a="",asideNode:n=null,children:s=null,beforeBack:u,showBackButton:m=!0,contentClassName:d=""}){const{goBack:h}=Object(l.useHistory)();return r.a.createElement("section",{className:`${i.a.section} ${t}`},r.a.createElement("header",null,m&&r.a.createElement(c.Button,{ghost:!0,onPointerUp:async()=>{(u&&await u()||!u)&&h()},shape:"circle",size:"small",icon:r.a.createElement(o.a,null)}),!1,e),r.a.createElement("div",{className:i.a.wrapper},r.a.createElement("aside",{className:a},n),r.a.createElement("main",{className:d},s)))}},77:function(t,e,a){t.exports={section:"section_c21f7",wrapper:"wrapper_e44d8"}},8:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return c}));var n=a(0),r=a.n(n),s=a(38),i=a.n(s);function c({name:t,content:e,id:a,onPointerUp:n}){return r.a.createElement("section",{className:i.a.workItem,onPointerUp:()=>n&&n(a)},r.a.createElement("div",{className:i.a.imgBox},e),r.a.createElement("p",null,t))}}}]);