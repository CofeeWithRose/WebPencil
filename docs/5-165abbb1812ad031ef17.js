(window.webpackJsonp=window.webpackJsonp||[]).push([[5,8,16,27,28],[,,,,function(e,t,a){"use strict";a.r(t);var n=a(46),r=a.n(n),o=a(0),c=a.n(o),i=a(1),s=a(36),d=a.n(s),u=a(45),l=a(22),f=a(15);const v=async e=>{const t=`record_${Date.now()}_${r()()}.png`,a=await Object(u.e)(e),n=`record/${t}`;return a&&await f.a.save({type:"image/png",data:a,path:n}),n};t.default=({pCanvasController:e})=>{const[{cursor:t,recorderList:a},n]=Object(o.useReducer)(l.recordListReducer,{cursor:-1,recorderList:[]}),r=t>=0,s=t<a.length-1;Object(o.useEffect)(()=>{const t=async e=>{const{data:{layerDetail:{canvas:t},index:a},tag:r}=e;if("history"===r)return;const o=await v(t);n({type:"add",payload:new l.RecordInfo("add",{index:a,canvasPath:o})})},a=async e=>{const{data:{layerDetail:{canvas:t},preContent:a,index:r},tag:o}=e;"history"!==o&&n({type:"add",payload:new l.RecordInfo("modify",{index:r,fromCanvasPath:await v(a),toCanvasPath:await v(t)})})},r=async e=>{const{data:{layerDetail:{canvas:t},index:a},tag:r}=e;if("history"===r)return;const o=await v(t);n({type:"add",payload:new l.RecordInfo("remove",{index:a,canvasPath:o})})};return e.on("addLayer",t),e.on("contentChange",a),e.on("removeLayer",r),()=>{e.off("addLayer",t),e.off("contentChange",a),e.off("removeLayer",r),f.a.remove("record")}},[]);return c.a.createElement(o.Fragment,null,c.a.createElement("span",{className:`${d.a.recordBtn} ${s&&d.a.recordBtnActive||""} `,onPointerUp:s&&(()=>{n({type:"redo",pCanvasController:e})})||void 0},"redo"),c.a.createElement(i.Divider,null),c.a.createElement("span",{className:`${d.a.recordBtn} ${r&&d.a.recordBtnActive||""}`,onPointerUp:r&&(()=>{n({type:"undo",pCanvasController:e})})||void 0},"undo"))}},,,,,function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(1),c=a(39),i=a.n(c),s=a(4);t.default=({pCanvasController:e})=>{Object(n.useEffect)(()=>{if(e){const t=()=>{e.setBrushWidth(1),e.setOpacity(1)};return e.on("init",t),()=>e.off("init",t)}},[]);return r.a.createElement("div",{className:i.a.asideTool},r.a.createElement(o.Divider,null),r.a.createElement(o.Slider,{defaultValue:1,vertical:!0,min:1,max:200,step:1,onChange:t=>{e&&e.setBrushWidth(t)}}),r.a.createElement(o.Divider,null),r.a.createElement(o.Slider,{vertical:!0,defaultValue:1,min:0,max:1,step:.01,onChange:t=>{e&&e.setOpacity(t)}}),r.a.createElement(o.Divider,null),r.a.createElement(s.default,{pCanvasController:e}),r.a.createElement(o.Divider,null))}},,,,,,,,,,,,,function(e,t,a){"use strict";a.r(t),a.d(t,"RecordData",(function(){return o})),a.d(t,"RecordInfo",(function(){return i})),a.d(t,"recordListReducer",(function(){return d}));var n=a(15),r=a(45);class o{constructor(){this.add=void 0,this.remove=void 0,this.modify=void 0}}const c=async({type:e,data:t})=>{switch(e){case"add":t=t,await n.a.remove(t.canvasPath,{isFile:!0});break;case"modify":const{fromCanvasPath:e,toCanvasPath:a}=t;await Promise.all([n.a.remove(e,{isFile:!0}),n.a.remove(a,{isFile:!0})]);break;case"remove":const{canvasPath:r}=t;await n.a.remove(r,{isFile:!0})}};class i{constructor(e,t){this.type=e,this.data=t}}const s=async(e,t)=>{const{type:a,data:o}=e;if("add"!==a)if("modify"!==a)if("remove"!==a);else{const{index:e}=o;t.removeLayerByIndex(e,"history")}else{const{index:e,fromCanvasPath:a,toCanvasPath:c}=o,[i]=await n.a.get(c,{isDir:!1}),s=await Object(r.c)(i),d=t.setLayerContent(e,s,"history");t.focusLayer(d)}else{const{index:e,canvasPath:a}=o,[c]=await n.a.get(a,{isDir:!1}),i=await Object(r.c)(c),s=t.addLayerContent(e,i,"history");t.focusLayer(s)}},d=({cursor:e,recorderList:t},{type:a,payload:n,pCanvasController:r})=>{switch(a){case"add":if(e<t.length-1){t.splice(Math.max(e,0)).map(e=>c(e))}if(100<=t.length){t.splice(0,t.length-100+1).map(e=>c(e))}e++,n&&t.push(n);break;case"redo":if(++e<=t.length-1){const a=t[e];r&&s(a,r)}break;case"undo":if(e>-1){const a=t[e];r&&s((({type:e,data:t})=>{if("add"===e){const{index:e,canvasPath:a}=t;return new i("remove",{index:e,canvasPath:a})}if("modify"===e){const{index:e,fromCanvasPath:a,toCanvasPath:n}=t;return new i("modify",{index:e,fromCanvasPath:n,toCanvasPath:a})}const{index:a,canvasPath:n}=t;return new i("add",{index:a,canvasPath:n})})(a),r)}e--}return{cursor:Math.max(Math.min(e,t.length-1),-1),recorderList:t}}},,,,,,,,,,,,,,function(e,t,a){e.exports={recordBtn:"recordBtn_81954",recordBtnActive:"recordBtnActive_a74d3"}},,,function(e,t,a){e.exports={asideTool:"asideTool_faaa6"}},,,,,,function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return c})),a.d(t,"c",(function(){return d})),a.d(t,"e",(function(){return u})),a.d(t,"d",(function(){return f}));var n=a(46),r=a.n(n);const o=(e=0,t=0,a)=>{const n=document.createElement("canvas");n.width=e,n.height=t,n.setAttribute("uuid",r()("canvasId-"));const o=n.getContext("2d");return o&&a&&(o.fillStyle=a.toRGBAString(),o.fillRect(0,0,e,t)),n},c=e=>{const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const a=t.getContext("2d");return a&&(a.imageSmoothingEnabled=!1,a.clearRect(0,0,t.width,t.height),a.drawImage(e,0,0,e.width,e.height)),t},i=[];let s=0;const d=async e=>new Promise(t=>{i.push({file:e,cb:t}),(async()=>{if(s<1){let e=i.shift();for(;e;){s++;const{file:t,cb:a}=e,n=new Image;n.src=URL.createObjectURL(t);try{await n.decode()}catch(e){}URL.revokeObjectURL(n.src),a(n),s--,e=i.shift()}}})()}),u=e=>new Promise(t=>{e.toBlob(t,"image/png",1)});let l=()=>{const e=o(0,0).toDataURL();return l=()=>e,l()};const f=()=>l()},function(e,t,a){var n=a(52),r=0;e.exports=function(e){var t=++r;return n(e)+t}},function(e,t,a){var n=a(49),r="object"==typeof self&&self&&self.Object===Object&&self,o=n||r||Function("return this")();e.exports=o},function(e,t){e.exports=function(){return!1}},function(e,t,a){(function(t){var a="object"==typeof t&&t&&t.Object===Object&&t;e.exports=a}).call(this,a(50))},function(e,t){var a;a=function(){return this}();try{a=a||new Function("return this")()}catch(e){"object"==typeof window&&(a=window)}e.exports=a},function(e,t){var a=Array.isArray;e.exports=a},function(e,t,a){var n=a(53);e.exports=function(e){return null==e?"":n(e)}},function(e,t,a){var n=a(54),r=a(55),o=a(51),c=a(48),i=n?n.prototype:void 0,s=i?i.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return r(t,e)+"";if(c(t))return s?s.call(t):"";var a=t+"";return"0"==a&&1/t==-1/0?"-0":a}},function(e,t,a){var n=a(47).Symbol;e.exports=n},function(e,t){e.exports=function(e,t){for(var a=-1,n=null==e?0:e.length,r=Array(n);++a<n;)r[a]=t(e[a],a,e);return r}}]]);