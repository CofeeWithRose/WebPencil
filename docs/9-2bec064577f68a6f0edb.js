(window.webpackJsonp=window.webpackJsonp||[]).push([[9,12,20,23,25,26],{13:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(76),i=a(41),c=a.n(i),o=a(8),l={name:"plus",theme:"outlined",icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M176 474h672q8 0 8 8v60q0 8-8 8H176q-8 0-8-8v-60q0-8 8-8z"}}]}},u=a(84),m=function(e,t){return n.createElement(u.a,Object.assign({},e,{ref:t,icon:l}))};m.displayName="PlusOutlined";var d=n.forwardRef(m),h=a(27),w=a(81),p=a.n(w),f=a(58),g=a(20),b=a(2);t.default=()=>{const[e,t]=Object(n.useState)(!1),[a,i]=Object(n.useState)([]),{push:l}=Object(b.useHistory)();Object(n.useEffect)(()=>((async()=>{const e=await f.c.getWorkList();i(e)})(),()=>{i([])}),[]);const u=e=>{l({pathname:"/paint",search:p.a.stringify({workId:e})})};return r.a.createElement(s.a,{showBackButton:!1,asideClass:c.a.asideClass},r.a.createElement("main",{className:c.a.listWrap},r.a.createElement(o.default,{id:"add",name:"新建",content:r.a.createElement(d,{style:{fontSize:"30px"}}),onPointerUp:()=>t(!0)}),a.map(({workId:e,name:t,thumbnail:a})=>r.a.createElement(o.default,{key:e,id:e,name:t,content:r.a.createElement("img",{src:a,onLoad:()=>URL.revokeObjectURL(a)}),onPointerUp:()=>u(e)}))),r.a.createElement(h.FileMenu,{isVisibale:e,onComplete:async({width:e,height:t})=>{const a=f.b.createEmpty(e,t,g.RGBA.WHITE);await f.c.saveWork(a),u(a.workInfo.workId)},onCancel:()=>t(!1)}))}},20:function(e,t,a){"use strict";a.r(t),a.d(t,"RGBA",(function(){return n}));class n{static Lerp(e,t,a){const r=[],s=(t.r-e.r)/a,i=(t.g-e.g)/a,c=(t.b-e.b)/a,o=(t.a-e.a)/a;for(let t=0;t<a;t++)r.push(new n(e.r+s*t,e.g+i*t,e.b+c*t,e.a+o*t));return r}static mutipy({r:e,g:t,b:a},r){return new n(e*r,t*r,a*r)}static add({r:e,g:t,b:a},r){return new n(e+r.r,t+r.g,a+r.b)}static mix(e,t,a){return new n(e.r+(t.r-e.r)*a,e.g+(t.g-e.g)*a,e.b+(t.b-e.b)*a)}static getLerpColor(e,t,a){const{r:r,g:s,b:i,a:c}=e;return new n((t.r-r)*a+r,(t.g-s)*a+s,(t.b-i)*a+i,(t.a-c)*a+c)}constructor(e,t,a,n=1){this.r=e,this.g=t,this.b=a,this.a=n}toRGBAString(){return`rgba(${this.r},${this.g},${this.b},${this.a})`}}n.BLACK=new n(0,0,0),n.WHITE=new n(255,255,255)},27:function(e,t,a){"use strict";a.r(t),a.d(t,"FileMenu",(function(){return i}));var n=a(0),r=a.n(n),s=a(1);const i=({className:e="",isVisibale:t,onComplete:a,onCancel:n})=>{const[i]=s.Form.useForm(),c=e=>`${e||0}px`,o=e=>(e||"").replace("px","");return r.a.createElement("div",null,r.a.createElement(s.Form,{form:i,initialValues:{width:2048,height:2048}},r.a.createElement(s.Modal,{visible:t,onCancel:n,title:"创建",className:e,okButtonProps:{onPointerUp:async()=>{const e=await i.validateFields();a&&a(e)}}},r.a.createElement(s.Form.Item,{name:"width",label:"宽度",rules:[{required:!0,message:"请填写画布宽度"}]},r.a.createElement(s.InputNumber,{min:1,max:4096,precision:0,formatter:c,parser:o})),r.a.createElement(s.Form.Item,{name:"height",label:"高度",rules:[{required:!0,message:"请填写画布高度"}]},r.a.createElement(s.InputNumber,{min:1,max:4096,precision:0,formatter:c,parser:o})))))}},38:function(e,t,a){e.exports={workItem:"workItem_b96c1",imgBox:"imgBox_8e40a"}},41:function(e,t,a){e.exports={listWrap:"listWrap_fdcf4",asideClass:"asideClass_03988"}},45:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return m})),a.d(t,"e",(function(){return d})),a.d(t,"d",(function(){return w}));var n=a(46),r=a.n(n),s=a(56);new(a.n(s).a);const i=(e=0,t=0,a)=>{const n=document.createElement("canvas");n.width=e,n.height=t,n.setAttribute("uuid",r()("canvasId-"));const s=n.getContext("2d");return s&&a&&(s.fillStyle=a.toRGBAString(),s.fillRect(0,0,e,t)),n},c=(e,t)=>{const a=e.getContext("2d");null==a||a.drawImage(t,0,0)},o=e=>{const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const a=t.getContext("2d"),n=e.getContext("2d");return a&&n&&(a.imageSmoothingEnabled=!1,a.putImageData(n.getImageData(0,0,e.width,e.height),0,0)),t},l=[];let u=0;const m=async e=>new Promise(t=>{l.push({file:e,cb:t}),(async()=>{if(u<1){let e=l.shift();for(;e;){u++;const{file:t,cb:a}=e,n=new Image,r=URL.createObjectURL(new Blob([t]));n.src=r;const s=document.createElement("canvas");try{await n.decode(),s.width=n.width,s.height=n.height,c(s,n)}catch(e){}URL.revokeObjectURL(r),a(s),u--,e=l.shift()}}})()}),d=e=>new Promise(t=>{e.toBlob(e=>(async(e,t)=>{if(e){const a=URL.createObjectURL(e);t(await(await fetch(a)).arrayBuffer())}else t(null)})(e,t),"image/png",1)});let h=()=>{const e=i(0,0).toDataURL();return h=()=>e,h()};const w=()=>h()},56:function(e,t,a){e.exports=function(){return new Worker(a.p+"WorkerName.b03f5c6277ae088ef23e.js")}},58:function(e,t,a){"use strict";a.d(t,"c",(function(){return f})),a.d(t,"b",(function(){return u})),a.d(t,"a",(function(){return m}));var n=a(59),r=a.n(n),s=a(46),i=a.n(s),c=a(20),o=a(45);class l{constructor(e,t,a="",n,r=Date.now(),s=Date.now(),c=i()(`work_${Date.now()}_`)){this.width=e,this.height=t,this.name=a,this.thumbnail=n,this.createTime=r,this.updateTime=s,this.workId=c}}class u{constructor(e,t=[]){this.workInfo=e,this.layers=t}static createEmpty(e,t,a){const n=new l(e,t,"new work",Object(o.d)()),r=[];return r.push(m.create(n,c.RGBA.WHITE)),new u(n,r)}}class m{constructor(e,t="new layer",a=!0,n=i()(`layer-${Date.now()}-`)){this.canvas=e,this.name=t,this.visible=a,this.layerId=n}static create({width:e,height:t},a){const n=Object(o.b)(e,t,a),r=new m(n);return n.setAttribute("layerId",r.layerId),r}}var d=a(15);const h=(e,t)=>t?`layers/${e}/${t}.png`:`layers/${e}`,w=e=>`thumbnail/${e}.png`;class p{constructor(e){this.workInfo=void 0,this.layers=void 0;const{workInfo:t,layers:a}=e,{thumbnail:n,workId:r,...s}=t;this.workInfo={workId:r,...s,thumbnail:w(r)},this.layers=a.map(({canvas:e,layerId:t,...a})=>({layerId:t,...a,canvas:h(r,t)}))}}class f{static async saveWork(e){if(!e)return;const t=new p(e);await this.saveWorkInfo(t);const a=this.getCanvasFileList(e,t);for(let e=0;e<a.length;e++){const{path:t,canvas:n}=a[e],{path:r,name:s}=d.a.analyzePath(t),i=await Object(o.e)(n);i&&await d.a.save({type:"image/png",path:r,data:i,name:s})}}static async saveWorkInfo(e){await d.a.save({type:"application/json",path:"",name:`${e.workInfo.workId}.json`,data:JSON.stringify(e)})}static getCanvasFileList(e,t){const{layers:a}=e,{layers:n}=t,r=[{path:t.workInfo.thumbnail,canvas:this.combimeCanvas(100,100,a.map(({canvas:e})=>e))}];return a.forEach(({canvas:e},t)=>{r.push({canvas:e,path:n[t].canvas})}),r}static combimeCanvas(e,t,a){const n=Object(o.b)(e,t),r=n.getContext("2d");if(r)for(let e=a.length-1;e>-1;e--){const t=a[e];r.drawImage(t,0,0,t.width,t.height)}return n}static async saveLayerDetail(e,t,a){const{canvas:n,layerId:s,...i}=t,c=await Object(o.e)(n);if(!c)return;const{path:l,name:u}=d.a.analyzePath(h(e,s));d.a.save({type:"image/png",path:l,name:u,data:c});const[{data:m}]=await d.a.get("",`${e}.json`),w=JSON.parse(m),p=w.layers.find(({layerId:e})=>e===s);if(!p&&r()(a)&&(w.layers.splice(a,0,{canvas:h(e,s),layerId:s,...i}),await this.saveWorkInfo(w)),p&&r()(a))throw"add layer fail: "+s}static async removeWork(e){}static async updateLayerDetail(e,t){}static async getWorkDetail(e){const[{data:t}]=await d.a.get("",`${e}.json`),{workInfo:a,layers:n}=JSON.parse(t),r=[],s=(await d.a.get(h(e))).reduce((e,{data:t,name:a})=>({...e,[a]:t}),{}),i=[];for(let e=0;e<n.length;e++){const{layerId:t,visible:a,name:r}=n[e],c=s[`${t}.png`];if(c)try{const e=await Object(o.c)(c);i.push({canvas:e,name:r,visible:a,layerId:t})}catch(e){}}return i.forEach(({canvas:e,name:t,visible:a,layerId:n},s)=>{const i=new m(e,t,a,n);r.push(i)}),new u(a,r)}static async getWorkList(){let e;const[t,a]=await Promise.all([d.a.get(""),d.a.get("thumbnail")]);return e=t.map(({data:e})=>e).map(e=>{const{workInfo:{thumbnail:t,workId:n,...r}}=JSON.parse(e),s=a.find(({name:e})=>e===`${n}.png`);if(s)return{...r,workId:n,thumbnail:URL.createObjectURL(new Blob([s.data]))};throw"workInfoList error "+n}),e}}},76:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(0),r=a.n(n),s=a(77),i=a.n(s),c=a(1),o=a(92),l=a(2);function u({className:e="",headNode:t=null,asideClass:a="",asideNode:n=null,children:s=null,beforeBack:u,showBackButton:m=!0,contentClassName:d=""}){const{goBack:h}=Object(l.useHistory)();return r.a.createElement("section",{className:`${i.a.section} ${e}`},r.a.createElement("header",null,m&&r.a.createElement(c.Button,{ghost:!0,onPointerUp:async()=>{(u&&await u()||!u)&&h()},shape:"circle",size:"small",icon:r.a.createElement(o.a,null)}),!1,t),r.a.createElement("div",{className:i.a.wrapper},r.a.createElement("aside",{className:a},n),r.a.createElement("main",{className:d},s)))}},77:function(e,t,a){e.exports={section:"section_c21f7",wrapper:"wrapper_e44d8"}},8:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(38),i=a.n(s);t.default=({name:e,content:t,id:a,onPointerUp:n})=>r.a.createElement("section",{className:i.a.workItem,onPointerUp:()=>n&&n(a)},r.a.createElement("div",{className:i.a.imgBox},t),r.a.createElement("p",null,e))}}]);