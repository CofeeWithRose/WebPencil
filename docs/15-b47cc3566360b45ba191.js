(window.webpackJsonp=window.webpackJsonp||[]).push([[15,23],{20:function(t,e,a){"use strict";a.r(e),a.d(e,"RGBA",(function(){return n}));class n{static Lerp(t,e,a){const r=[],s=(e.r-t.r)/a,i=(e.g-t.g)/a,o=(e.b-t.b)/a,c=(e.a-t.a)/a;for(let e=0;e<a;e++)r.push(new n(t.r+s*e,t.g+i*e,t.b+o*e,t.a+c*e));return r}static mutipy({r:t,g:e,b:a},r){return new n(t*r,e*r,a*r)}static add({r:t,g:e,b:a},r){return new n(t+r.r,e+r.g,a+r.b)}static mix(t,e,a){return new n(t.r+(e.r-t.r)*a,t.g+(e.g-t.g)*a,t.b+(e.b-t.b)*a)}static getLerpColor(t,e,a){const{r:r,g:s,b:i,a:o}=t;return new n((e.r-r)*a+r,(e.g-s)*a+s,(e.b-i)*a+i,(e.a-o)*a+o)}constructor(t,e,a,n=1){this.r=t,this.g=e,this.b=a,this.a=n}toRGBAString(){return`rgba(${this.r},${this.g},${this.b},${this.a})`}}n.BLACK=new n(0,0,0),n.WHITE=new n(255,255,255)},26:function(t,e,a){"use strict";a.r(e),a.d(e,"PcanvasLayers",(function(){return r}));var n=a(58);class r{constructor(t){this.wrapInfo=t,this.tempLayer=void 0,this.layers=void 0,this.focusedLayerDetail=void 0}async init(t){const e=this.wrapInfo,{wrap:a,cover:r}=e;let s=r;this.layers=t,t.forEach((t,e)=>{const{canvas:n,layerId:r,visible:i}=t;a.insertBefore(n,s),s=n,i||(n.className="unvisible")}),this.tempLayer=n.a.create(e),a.insertBefore(this.tempLayer.canvas,r),this.focusedLayerDetail=t[0]}getCanvas(){return this.tempLayer.canvas}applyTempCanvas(){const t=this.focusedLayerDetail.canvas.getContext("2d"),e=this.tempLayer.canvas.getContext("2d");if(t&&e){const{width:a,height:n}=this.tempLayer.canvas;t.drawImage(this.tempLayer.canvas,0,0,a,n),e.clearRect(0,0,a,n)}}getFocusDetail(){return this.focusedLayerDetail}focusLayer(t){const e=this.layers[this.layers.indexOf(t)-1],a=e&&e.canvas&&e!==this.tempLayer?e.canvas:this.wrapInfo.cover;this.wrapInfo.wrap.insertBefore(this.tempLayer.canvas,a),this.focusedLayerDetail=t}addLayer(t,e=0){const{wrap:a}=this.wrapInfo,n=this.layers[e-1],r=n&&n.canvas||this.wrapInfo.cover;return a.insertBefore(t.canvas,r),this.layers.splice(e,0,t),t}removeLayer(t){const e=this.layers.indexOf(t);return e>-1&&(this.wrapInfo.wrap.removeChild(t.canvas),this.layers.splice(e,1)),{index:e,isFocus:this.focusedLayerDetail===t}}getContext(){const t=this.tempLayer.canvas.getContext("2d");if(null===t)throw"get context faliled.";return t.imageSmoothingEnabled=!1,t}}},45:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"a",(function(){return c})),a.d(e,"c",(function(){return l})),a.d(e,"e",(function(){return f})),a.d(e,"d",(function(){return p}));var n=a(46),r=a.n(n),s=a(56);new(a.n(s).a);const i=(t=0,e=0,a)=>{const n=document.createElement("canvas");n.width=t,n.height=e,n.setAttribute("uuid",r()("canvasId-"));const s=n.getContext("2d");return s&&a&&(s.fillStyle=a.toRGBAString(),s.fillRect(0,0,t,e)),n},o=(t,e)=>{const a=t.getContext("2d");null==a||a.drawImage(e,0,0)},c=t=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const a=e.getContext("2d"),n=t.getContext("2d");return a&&n&&(a.imageSmoothingEnabled=!1,a.putImageData(n.getImageData(0,0,t.width,t.height),0,0)),e},u=[];let h=0;const l=async t=>new Promise(e=>{u.push({file:t,cb:e}),(async()=>{if(h<1){let t=u.shift();for(;t;){h++;const{file:e,cb:a}=t,n=new Image,r=URL.createObjectURL(new Blob([e]));n.src=r;const s=document.createElement("canvas");try{await n.decode(),s.width=n.width,s.height=n.height,o(s,n)}catch(t){}URL.revokeObjectURL(r),a(s),h--,t=u.shift()}}})()}),f=t=>new Promise(e=>{t.toBlob(t=>(async(t,e)=>{if(t){const a=URL.createObjectURL(t);e(await(await fetch(a)).arrayBuffer())}else e(null)})(t,e),"image/png",1)});let d=()=>{const t=i(0,0).toDataURL();return d=()=>t,d()};const p=()=>d()},46:function(t,e,a){var n=a(52),r=0;t.exports=function(t){var e=++r;return n(t)+e}},47:function(t,e,a){var n=a(49),r="object"==typeof self&&self&&self.Object===Object&&self,s=n||r||Function("return this")();t.exports=s},48:function(t,e){t.exports=function(){return!1}},49:function(t,e,a){(function(e){var a="object"==typeof e&&e&&e.Object===Object&&e;t.exports=a}).call(this,a(50))},50:function(t,e){var a;a=function(){return this}();try{a=a||new Function("return this")()}catch(t){"object"==typeof window&&(a=window)}t.exports=a},51:function(t,e){var a=Array.isArray;t.exports=a},52:function(t,e,a){var n=a(53);t.exports=function(t){return null==t?"":n(t)}},53:function(t,e,a){var n=a(54),r=a(55),s=a(51),i=a(48),o=n?n.prototype:void 0,c=o?o.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(s(e))return r(e,t)+"";if(i(e))return c?c.call(e):"";var a=e+"";return"0"==a&&1/e==-1/0?"-0":a}},54:function(t,e,a){var n=a(47).Symbol;t.exports=n},55:function(t,e){t.exports=function(t,e){for(var a=-1,n=null==t?0:t.length,r=Array(n);++a<n;)r[a]=e(t[a],a,t);return r}},56:function(t,e,a){t.exports=function(){return new Worker(a.p+"WorkerName.4812e85ebc24635efccf.js")}},58:function(t,e,a){"use strict";a.d(e,"c",(function(){return y})),a.d(e,"b",(function(){return h})),a.d(e,"a",(function(){return l}));var n=a(59),r=a.n(n),s=a(46),i=a.n(s),o=a(20),c=a(45);class u{constructor(t,e,a="",n,r=Date.now(),s=Date.now(),o=i()(`work_${Date.now()}_`)){this.width=t,this.height=e,this.name=a,this.thumbnail=n,this.createTime=r,this.updateTime=s,this.workId=o}}class h{constructor(t,e=[]){this.workInfo=t,this.layers=e}static createEmpty(t,e,a){const n=new u(t,e,"new work",Object(c.d)()),r=[];return r.push(l.create(n,o.RGBA.WHITE)),new h(n,r)}}class l{constructor(t,e="new layer",a=!0,n=i()(`layer-${Date.now()}-`)){this.canvas=t,this.name=e,this.visible=a,this.layerId=n}static create({width:t,height:e},a){const n=Object(c.b)(t,e,a),r=new l(n);return n.setAttribute("layerId",r.layerId),r}}var f=a(15);const d=(t,e)=>e?`layers/${t}/${e}.png`:`layers/${t}`,p=t=>`thumbnail/${t}.png`;class w{constructor(t){this.workInfo=void 0,this.layers=void 0;const{workInfo:e,layers:a}=t,{thumbnail:n,workId:r,...s}=e;this.workInfo={workId:r,...s,thumbnail:p(r)},this.layers=a.map(({canvas:t,layerId:e,...a})=>({layerId:e,...a,canvas:d(r,e)}))}}class y{static async saveWork(t){if(!t)return;const e=new w(t);await this.saveWorkInfo(e);const a=this.getCanvasFileList(t,e);for(let t=0;t<a.length;t++){const{path:e,canvas:n}=a[t],{path:r,name:s}=f.a.analyzePath(e),i=await Object(c.e)(n);i&&await f.a.save({type:"image/png",path:r,data:i,name:s})}}static async saveWorkInfo(t){await f.a.save({type:"application/json",path:"",name:`${t.workInfo.workId}.json`,data:JSON.stringify(t)})}static getCanvasFileList(t,e){const{layers:a}=t,{layers:n}=e,r=[{path:e.workInfo.thumbnail,canvas:this.combimeCanvas(100,100,a.map(({canvas:t})=>t))}];return a.forEach(({canvas:t},e)=>{r.push({canvas:t,path:n[e].canvas})}),r}static combimeCanvas(t,e,a){const n=Object(c.b)(t,e),r=n.getContext("2d");if(r)for(let t=a.length-1;t>-1;t--){const e=a[t];r.drawImage(e,0,0,e.width,e.height)}return n}static async saveLayerDetail(t,e,a){const{canvas:n,layerId:s,...i}=e,o=await Object(c.e)(n);if(!o)return;const{path:u,name:h}=f.a.analyzePath(d(t,s));f.a.save({type:"image/png",path:u,name:h,data:o});const[{data:l}]=await f.a.get("",`${t}.json`),p=JSON.parse(l),w=p.layers.find(({layerId:t})=>t===s);if(!w&&r()(a)&&(p.layers.splice(a,0,{canvas:d(t,s),layerId:s,...i}),await this.saveWorkInfo(p)),w&&r()(a))throw"add layer fail: "+s}static async removeWork(t){}static async updateLayerDetail(t,e){}static async getWorkDetail(t){const[{data:e}]=await f.a.get("",`${t}.json`),{workInfo:a,layers:n}=JSON.parse(e),r=[],s=(await f.a.get(d(t))).reduce((t,{data:e,name:a})=>({...t,[a]:e}),{}),i=[];for(let t=0;t<n.length;t++){const{layerId:e,visible:a,name:r}=n[t],o=s[`${e}.png`];if(o)try{const t=await Object(c.c)(o);i.push({canvas:t,name:r,visible:a,layerId:e})}catch(t){}}return i.forEach(({canvas:t,name:e,visible:a,layerId:n},s)=>{const i=new l(t,e,a,n);r.push(i)}),new h(a,r)}static async getWorkList(){let t;const[e,a]=await Promise.all([f.a.get(""),f.a.get("thumbnail")]);return t=e.map(({data:t})=>t).map(t=>{const{workInfo:{thumbnail:e,workId:n,...r}}=JSON.parse(t),s=a.find(({name:t})=>t===`${n}.png`);if(s)return{...r,workId:n,thumbnail:URL.createObjectURL(new Blob([s.data]))};throw"workInfoList error "+n}),t}}},59:function(t,e,a){var n=a(60),r=a(61);t.exports=function(t){return"number"==typeof t||r(t)&&"[object Number]"==n(t)}},60:function(t,e){var a=Object.prototype.toString;t.exports=function(t){return a.call(t)}},61:function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}}}]);