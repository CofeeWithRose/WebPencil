(window.webpackJsonp=window.webpackJsonp||[]).push([[14,13,15,18,22,23],[,,,function(t,e,n){"use strict";n.r(e),n.d(e,"Brush",(function(){return s}));var r=n(21);class s{constructor(){this.type=r.BrushType.pen,this.name="default",this.isPainting=!1,this.pathList=[],this.animeHandle=void 0,this.paintPath=t=>{t.clearRect(0,0,t.canvas.width,t.canvas.height),t.beginPath();const e=this.pathList[0];t.moveTo(e.x,e.y);for(let e=1;e<this.pathList.length;e++){const{x:n,y:r}=this.pathList[e];t.lineTo(n,r)}t.stroke()}}init(){}destory(){}onStart(t,e){const{curCanvasContext2D:n,color:r,brushWidth:s}=e;this.isPainting=!0,this.pathList.push(t),n.strokeStyle=r,n.lineWidth=s,n.lineCap="round",n.lineJoin="round"}onDraw(t,e){if(this.isPainting){const{curCanvasContext2D:n}=e;for(let e=0;e<t.length;e++)this.pathList.push(t[e]);cancelAnimationFrame(this.animeHandle),this.animeHandle=requestAnimationFrame(()=>{this.paintPath(n)})}}onEnd(t,{onBrushEnd:e}){requestAnimationFrame(()=>{this.isPainting=!1,this.pathList=[],e()})}}},,,,,,,,,,,,,,,,,function(t,e,n){"use strict";n.r(e),n.d(e,"RGBA",(function(){return r}));class r{static Lerp(t,e,n){const s=[],i=(e.r-t.r)/n,a=(e.g-t.g)/n,o=(e.b-t.b)/n,c=(e.a-t.a)/n;for(let e=0;e<n;e++)s.push(new r(t.r+i*e,t.g+a*e,t.b+o*e,t.a+c*e));return s}static mutipy({r:t,g:e,b:n},s){return new r(t*s,e*s,n*s)}static add({r:t,g:e,b:n},s){return new r(t+s.r,e+s.g,n+s.b)}static mix(t,e,n){return new r(t.r+(e.r-t.r)*n,t.g+(e.g-t.g)*n,t.b+(e.b-t.b)*n)}static getLerpColor(t,e,n){const{r:s,g:i,b:a,a:o}=t;return new r((e.r-s)*n+s,(e.g-i)*n+i,(e.b-a)*n+a,(e.a-o)*n+o)}constructor(t,e,n,r=1){this.r=t,this.g=e,this.b=n,this.a=r}toRGBAString(){return`rgba(${this.r},${this.g},${this.b},${this.a})`}}r.BLACK=new r(0,0,0),r.WHITE=new r(255,255,255)},function(t,e,n){"use strict";n.r(e),n.d(e,"BrushStatus",(function(){return r})),n.d(e,"BrushType",(function(){return s})),n.d(e,"AbstractBrush",(function(){return i}));class r{constructor(t,e,n,r,s){this.x=t,this.y=e,this.pressure=n,this.tiltX=r,this.tiltY=s}}let s;!function(t){t[t.pen=1]="pen",t[t.selector=2]="selector"}(s||(s={}));class i{constructor(t,e){this.type=t,this.name=e}init(){}destory(){}onStart(t,e){}onDraw(t,e){}onEnd(t,e){}}},,,function(t,e,n){"use strict";n.r(e),n.d(e,"CanvasEvent",(function(){return u})),n.d(e,"PCanvasController",(function(){return f}));var r=n(20),s=n(25),i=n(58),a=n(26),o=n(75);var c=n(45),h=n(21);class u{constructor(t,e="user"){this.data=t,this.tag=e}}const l=({offsetX:t,offsetY:e,tiltX:n,tiltY:r,pressure:s})=>(s=s>1?.01*s:0===s?1:s,new h.BrushStatus(t,e,s,n,r));class f extends class{constructor(){this.eventEmitter=new o.EventEmitter}on(t,e){const n=e;this.eventEmitter.addListener(t,n)}off(t,e){const n=e;this.eventEmitter.removeListener(t,n)}emit(t,e){setTimeout(()=>{this.eventEmitter.emit(t,e)},1)}}{constructor(...t){super(...t),this.context=void 0,this.layerManager=void 0,this.color=r.RGBA.BLACK,this.pointerIds={},this.workId=void 0,this.onBrushEnd=()=>{const t=this.layerManager.getFocusDetail(),e=Object(c.a)(t.canvas);this.layerManager.applyTempCanvas();const n=this.layerManager.layers.indexOf(t);this.emit("contentChange",new u({workId:this.workId,layerDetail:t,preContent:e,index:n}))}}async init({wrap:t,cover:e},n){const{width:r,height:i,workId:o}=n.workInfo;t.style.width=`${r}px`,t.style.height=`${i}px`,this.workId=o,this.layerManager=new a.PcanvasLayers({cover:e,wrap:t,width:r,height:i}),this.layerManager.init(n.layers),this.context=new s.PCanvasContext(this.layerManager.getCanvas(),this.layerManager.getContext(),r,i,this.onBrushEnd),this.emit("init",new u(null)),this.emit("focusLayer",new u({layerDetail:this.layerManager.getFocusDetail()}))}setColor({r:t,g:e,b:n}){const s=new r.RGBA(t,e,n,this.color.a);this.setRGBA(s)}setRGBA(t){this.context.color=t.toRGBAString(),this.color=t,this.emit("colorchange",new u({color:t}))}setOpacity(t){const{r:e,g:n,b:s}=this.color,i=new r.RGBA(e,n,s,t);this.setRGBA(i)}async getLayers(){return[...this.layerManager.layers]}addLayer(){const t=this.layerManager.addLayer(i.a.create(this.layerManager.wrapInfo));this.layerManager.focusLayer(t);const e=this.layerManager.layers.indexOf(t);this.emit("addLayer",new u({workId:this.workId,layerDetail:t,index:e})),this.emit("focusLayer",new u({layerDetail:t}))}addLayerContent(t,e,n="user"){const{width:r,height:s}=e,a=i.a.create({width:r,height:s}),o=a.canvas.getContext("2d");return null==o||o.drawImage(e,0,0,r,s),this.layerManager.addLayer(a,t),this.emit("addLayer",new u({workId:this.workId,layerDetail:a,index:t},n)),a}setLayerContent(t,e,n="user"){const r=this.layerManager.layers[t],s=r.canvas,{width:i,height:a}=s,o=Object(c.a)(r.canvas),h=r.canvas.getContext("2d");return null==h||h.clearRect(0,0,i,a),null==h||h.drawImage(e,0,0,i,a),this.emit("contentChange",new u({workId:this.workId,layerDetail:r,index:t,preContent:o},n)),r}focusLayer(t){this.layerManager.focusLayer(t),this.emit("focusLayer",new u({layerDetail:t}))}removeLayer(t,e="user"){const{index:n,isFocus:r}=this.layerManager.removeLayer(t);if(this.emit("removeLayer",new u({workId:this.workId,layerDetail:t,index:n},e)),r){const t=this.layerManager.layers[0];this.focusLayer(t),this.emit("focusLayer",new u({layerDetail:t},e))}}removeLayerByIndex(t,e="user"){const n=this.layerManager.layers[t];this.removeLayer(n,e)}setBrushWidth(t){this.context.brushWidth=t}setBrush(t){this.context.brush&&this.context.brush.destory(),t.init(),this.context.brush=t}onPointerDown(t){this.pointerIds[t.pointerId]=!0;const e=l(t);this.context.brush.onStart(e,this.context)}onPointerMove(t){if(Object.keys(this.pointerIds).length>1)return;let e;e=t.getCoalescedEvents?t.getCoalescedEvents():[t],this.context.brush.onDraw(e.map(t=>l(t)),this.context)}onPointerUp(t){delete this.pointerIds[t.pointerId],this.context.brush.onEnd(l(t),this.context)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"PCanvasContext",(function(){return i}));var r=n(20),s=n(3);class i{constructor(t,e,n,i,a,o=new s.Brush,c=r.RGBA.BLACK.toRGBAString(),h=100){this.curCanvas=t,this.curCanvasContext2D=e,this.width=n,this.height=i,this.onBrushEnd=a,this.brush=o,this.color=c,this.brushWidth=h}}},function(t,e,n){"use strict";n.r(e),n.d(e,"PcanvasLayers",(function(){return s}));var r=n(58);class s{constructor(t){this.wrapInfo=t,this.tempLayer=void 0,this.layers=void 0,this.focusedLayerDetail=void 0}async init(t){const e=this.wrapInfo,{wrap:n,cover:s}=e;let i=s;this.layers=t,t.forEach((t,e)=>{const{canvas:r,layerId:s,visible:a}=t;n.insertBefore(r,i),i=r,a||(r.className="unvisible")}),this.tempLayer=r.a.create(e),n.insertBefore(this.tempLayer.canvas,s),this.focusedLayerDetail=t[0]}getCanvas(){return this.tempLayer.canvas}applyTempCanvas(){const t=this.focusedLayerDetail.canvas.getContext("2d"),e=this.tempLayer.canvas.getContext("2d");if(t&&e){const{width:n,height:r}=this.tempLayer.canvas;t.drawImage(this.tempLayer.canvas,0,0,n,r),e.clearRect(0,0,n,r)}}getFocusDetail(){return this.focusedLayerDetail}focusLayer(t){const e=this.layers[this.layers.indexOf(t)-1],n=e&&e.canvas&&e!==this.tempLayer?e.canvas:this.wrapInfo.cover;this.wrapInfo.wrap.insertBefore(this.tempLayer.canvas,n),this.focusedLayerDetail=t}addLayer(t,e=0){const{wrap:n}=this.wrapInfo,r=this.layers[e-1],s=r&&r.canvas||this.wrapInfo.cover;return n.insertBefore(t.canvas,s),this.layers.splice(e,0,t),t}removeLayer(t){const e=this.layers.indexOf(t);return e>-1&&(this.wrapInfo.wrap.removeChild(t.canvas),this.layers.splice(e,1)),{index:e,isFocus:this.focusedLayerDetail===t}}getContext(){const t=this.tempLayer.canvas.getContext("2d");if(null===t)throw"get context faliled.";return t.imageSmoothingEnabled=!1,t}}},,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return c})),n.d(e,"c",(function(){return l})),n.d(e,"e",(function(){return f})),n.d(e,"d",(function(){return y}));var r=n(46),s=n.n(r),i=n(56);new(n.n(i).a);const a=(t=0,e=0,n)=>{const r=document.createElement("canvas");r.width=t,r.height=e,r.setAttribute("uuid",s()("canvasId-"));const i=r.getContext("2d");return i&&n&&(i.fillStyle=n.toRGBAString(),i.fillRect(0,0,t,e)),r},o=(t,e)=>{const n=t.getContext("2d");null==n||n.drawImage(e,0,0)},c=t=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d"),r=t.getContext("2d");return n&&r&&(n.imageSmoothingEnabled=!1,n.putImageData(r.getImageData(0,0,t.width,t.height),0,0)),e},h=[];let u=0;const l=async t=>new Promise(e=>{h.push({file:t,cb:e}),(async()=>{if(u<1){let t=h.shift();for(;t;){u++;const{file:e,cb:n}=t,r=new Image,s=URL.createObjectURL(new Blob([e]));r.src=s;const i=document.createElement("canvas");try{await r.decode(),i.width=r.width,i.height=r.height,o(i,r)}catch(t){}URL.revokeObjectURL(s),n(i),u--,t=h.shift()}}})()}),f=t=>new Promise(e=>{t.toBlob(t=>(async(t,e)=>{if(t){const n=URL.createObjectURL(t);e(await(await fetch(n)).arrayBuffer())}else e(null)})(t,e),"image/png",1)});let d=()=>{const t=a(0,0).toDataURL();return d=()=>t,d()};const y=()=>d()},function(t,e,n){var r=n(52),s=0;t.exports=function(t){var e=++s;return r(t)+e}},function(t,e,n){var r=n(49),s="object"==typeof self&&self&&self.Object===Object&&self,i=r||s||Function("return this")();t.exports=i},function(t,e){t.exports=function(){return!1}},function(t,e,n){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(this,n(50))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){var n=Array.isArray;t.exports=n},function(t,e,n){var r=n(53);t.exports=function(t){return null==t?"":r(t)}},function(t,e,n){var r=n(54),s=n(55),i=n(51),a=n(48),o=r?r.prototype:void 0,c=o?o.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(i(e))return s(e,t)+"";if(a(e))return c?c.call(e):"";var n=e+"";return"0"==n&&1/e==-1/0?"-0":n}},function(t,e,n){var r=n(47).Symbol;t.exports=r},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,s=Array(r);++n<r;)s[n]=e(t[n],n,t);return s}},function(t,e,n){t.exports=function(){return new Worker(n.p+"WorkerName.b03f5c6277ae088ef23e.js")}},,function(t,e,n){"use strict";n.d(e,"c",(function(){return v})),n.d(e,"b",(function(){return u})),n.d(e,"a",(function(){return l}));var r=n(59),s=n.n(r),i=n(46),a=n.n(i),o=n(20),c=n(45);class h{constructor(t,e,n="",r,s=Date.now(),i=Date.now(),o=a()(`work_${Date.now()}_`)){this.width=t,this.height=e,this.name=n,this.thumbnail=r,this.createTime=s,this.updateTime=i,this.workId=o}}class u{constructor(t,e=[]){this.workInfo=t,this.layers=e}static createEmpty(t,e,n){const r=new h(t,e,"new work",Object(c.d)()),s=[];return s.push(l.create(r,o.RGBA.WHITE)),new u(r,s)}}class l{constructor(t,e="new layer",n=!0,r=a()(`layer-${Date.now()}-`)){this.canvas=t,this.name=e,this.visible=n,this.layerId=r}static create({width:t,height:e},n){const r=Object(c.b)(t,e,n),s=new l(r);return r.setAttribute("layerId",s.layerId),s}}var f=n(15);const d=(t,e)=>e?`layers/${t}/${e}.png`:`layers/${t}`,y=t=>`thumbnail/${t}.png`;class p{constructor(t){this.workInfo=void 0,this.layers=void 0;const{workInfo:e,layers:n}=t,{thumbnail:r,workId:s,...i}=e;this.workInfo={workId:s,...i,thumbnail:y(s)},this.layers=n.map(({canvas:t,layerId:e,...n})=>({layerId:e,...n,canvas:d(s,e)}))}}class v{static async saveWork(t){if(!t)return;const e=new p(t);await this.saveWorkInfo(e);const n=this.getCanvasFileList(t,e);for(let t=0;t<n.length;t++){const{path:e,canvas:r}=n[t],{path:s,name:i}=f.a.analyzePath(e),a=await Object(c.e)(r);a&&await f.a.save({type:"image/png",path:s,data:a,name:i})}}static async saveWorkInfo(t){await f.a.save({type:"application/json",path:"",name:`${t.workInfo.workId}.json`,data:JSON.stringify(t)})}static getCanvasFileList(t,e){const{layers:n}=t,{layers:r}=e,s=[{path:e.workInfo.thumbnail,canvas:this.combimeCanvas(100,100,n.map(({canvas:t})=>t))}];return n.forEach(({canvas:t},e)=>{s.push({canvas:t,path:r[e].canvas})}),s}static combimeCanvas(t,e,n){const r=Object(c.b)(t,e),s=r.getContext("2d");if(s)for(let t=n.length-1;t>-1;t--){const e=n[t];s.drawImage(e,0,0,e.width,e.height)}return r}static async saveLayerDetail(t,e,n){const{canvas:r,layerId:i,...a}=e,o=await Object(c.e)(r);if(!o)return;const{path:h,name:u}=f.a.analyzePath(d(t,i));f.a.save({type:"image/png",path:h,name:u,data:o});const[{data:l}]=await f.a.get("",`${t}.json`),y=JSON.parse(l),p=y.layers.find(({layerId:t})=>t===i);if(!p&&s()(n)&&(y.layers.splice(n,0,{canvas:d(t,i),layerId:i,...a}),await this.saveWorkInfo(y)),p&&s()(n))throw"add layer fail: "+i}static async removeWork(t){}static async updateLayerDetail(t,e){}static async getWorkDetail(t){const[{data:e}]=await f.a.get("",`${t}.json`),{workInfo:n,layers:r}=JSON.parse(e),s=[],i=(await f.a.get(d(t))).reduce((t,{data:e,name:n})=>({...t,[n]:e}),{}),a=[];for(let t=0;t<r.length;t++){const{layerId:e,visible:n,name:s}=r[t],o=i[`${e}.png`];if(o)try{const t=await Object(c.c)(o);a.push({canvas:t,name:s,visible:n,layerId:e})}catch(t){}}return a.forEach(({canvas:t,name:e,visible:n,layerId:r},i)=>{const a=new l(t,e,n,r);s.push(a)}),new u(n,s)}static async getWorkList(){let t;const[e,n]=await Promise.all([f.a.get(""),f.a.get("thumbnail")]);return t=e.map(({data:t})=>t).map(t=>{const{workInfo:{thumbnail:e,workId:r,...s}}=JSON.parse(t),i=n.find(({name:t})=>t===`${r}.png`);if(i)return{...s,workId:r,thumbnail:URL.createObjectURL(new Blob([i.data]))};throw"workInfoList error "+r}),t}}},function(t,e,n){var r=n(60),s=n(61);t.exports=function(t){return"number"==typeof t||s(t)&&"[object Number]"==r(t)}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},,,,,,,,,,,,,,function(t,e,n){"use strict";var r,s="object"==typeof Reflect?Reflect:null,i=s&&"function"==typeof s.apply?s.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};r=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function h(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function u(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function l(t,e,n,r){var s,i,a;if(h(n),void 0===(i=t._events)?(i=t._events=Object.create(null),t._eventsCount=0):(void 0!==i.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),a=i[e]),void 0===a)a=i[e]=n,++t._eventsCount;else if("function"==typeof a?a=i[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(s=u(t))>0&&a.length>s&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=t,o.type=e,o.count=a.length,console&&console.warn}return t}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},s=f.bind(r);return s.listener=n,r.wrapFn=s,s}function y(t,e,n){var r=t._events;if(void 0===r)return[];var s=r[e];return void 0===s?[]:"function"==typeof s?n?[s.listener||s]:[s]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(s):v(s,s.length)}function p(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");c=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=s[t];if(void 0===c)return!1;if("function"==typeof c)i(c,this,e);else{var h=c.length,u=v(c,h);for(n=0;n<h;++n)i(u[n],this,e)}return!0},o.prototype.addListener=function(t,e){return l(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return l(this,t,e,!0)},o.prototype.once=function(t,e){return h(e),this.on(t,d(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return h(e),this.prependListener(t,d(this,t,e)),this},o.prototype.removeListener=function(t,e){var n,r,s,i,a;if(h(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(s=-1,i=n.length-1;i>=0;i--)if(n[i]===e||n[i].listener===e){a=n[i].listener,s=i;break}if(s<0)return this;0===s?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,s),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var s,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(s=i[r])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},o.prototype.listeners=function(t){return y(this,t,!0)},o.prototype.rawListeners=function(t){return y(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}}]]);